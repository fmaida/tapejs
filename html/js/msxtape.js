var Parameters=function(){function t(){this.blocco_intestazione=new Uint8Array([31,166,222,186,204,19,125,116]),this.blocco_file_ascii=new Uint8Array([234,234,234,234,234,234,234,234,234,234]),this.blocco_file_basic=new Uint8Array([211,211,211,211,211,211,211,211,211,211]),this.blocco_file_binario=new Uint8Array([208,208,208,208,208,208,208,208,208,208]),this.frequenza=28800,this.bitrate=2400,this.ampiezza=.9,this.sincronismo_lungo=2500,this.sincronismo_corto=1500,this.silenzio_lungo=2500,this.silenzio_corto=1500}return t}(),Buffer=function(){function t(){}return t.prototype.carica=function(t){this.dati=t},t.prototype.contiene=function(t,i){void 0===i&&(i=0);for(var e=0,a=!0;e<t.byteLength&&a;)this.dati[i+e]!==t[e]&&(a=!1),e++;return a},t.prototype.cerca=function(t,i){void 0===i&&(i=0);for(var e=i,a=-1,n=!1;e<this.dati.byteLength&&!n;)this.contiene(t,e)&&(a=e,n=!0),e++;return a},t.prototype.splitta=function(t,i){void 0===t&&(t=0),void 0===i&&(i=this.dati.byteLength);var e;if(e=new Uint8Array(i-t),"undefined"!=typeof this.dati.slice)e=this.dati.slice(t,i);else for(var a=t;i>a;a++)e[a-t]=this.dati[a];return e},t.prototype.length=function(){return this.dati.byteLength},t}(),DataBlock=function(){function t(t){void 0===t&&(t=null),null!==t&&this.set_data(t)}return t.prototype.set_name=function(t){t.length>6&&(t=t.substring(0,6)),this.name=t},t.prototype.get_name=function(){return this.name},t.prototype.set_type=function(t){this.type=t},t.prototype.get_type=function(){return this.type},t.prototype.is_custom=function(){return"custom"==this.type},t.prototype.set_data=function(t){if(this.data=t,this.type=this.analyze_block_type(),!this.is_custom()){this.set_name(this.analyze_block_name());for(var i=new Uint8Array(t.byteLength-16),e=16;e<t.byteLength;e++)i[e-16]=t[e];this.data=i}},t.prototype.append_block=function(t){for(var i=new Uint8Array(this.data.byteLength+t.data.byteLength),e=0,a=0;a<this.data.byteLength;a++)i[e+a]=this.data[a];e+=this.data.byteLength;for(var a=0;a<t.data.byteLength;a++)i[e+a]=t.data[a];this.data=i,this.set_data_end(t.get_data_end())},t.prototype.contains=function(t){for(var i=!0,e=0;e<t.length;e++)this.data[e]!==t[e]&&(i=!1,e=t.byteLength);return i},t.prototype.analyze_block_type=function(){var i="custom";return this.contains(t.parametri.blocco_file_ascii)?i="ascii":this.contains(t.parametri.blocco_file_basic)?i="basic":this.contains(t.parametri.blocco_file_binario)&&(i="binary"),i},t.prototype.analyze_block_name=function(){for(var t="",i=10,e=i;i+6>e;e++)t+=String.fromCharCode(this.data[e]);return t},t.prototype.get_data=function(){return this.data},t.prototype.set_data_begin=function(t){this.data_begin=t},t.prototype.get_data_begin=function(){return this.data_begin},t.prototype.set_data_end=function(t){this.data_end=t},t.prototype.get_data_end=function(){return this.data_end},t.prototype.get_data_length=function(){var t=this.data_end-this.data_begin;return 0>t&&(t=-1),t},t}(),MSX=function(){function t(){this.parametri=new Parameters,this.buffer=new Buffer,this.audio=new Audio,this.wave=new RIFFWAVE,this.data=[],this.wave.header.sampleRate=this.parametri.frequenza,this.wave.header.numChannels=1,this.ricalcola_onde(),DataBlock.parametri=this.parametri}return t.prototype.ricalcola_onde=function(){var t=this.parametri;t.campionamenti=t.frequenza/t.bitrate;var i=Math.floor(t.campionamenti/4),e=Math.floor(255*t.ampiezza),a=255-e,n,r=[];for(n=0;2*i>n;n++)r.push(a);for(var o=0;2*i>o;o++)r.push(e);for(t.wave_bit_0=new Uint8Array(r),r=[],n=0;i>n;n++)r.push(a);for(n=0;i>n;n++)r.push(e);for(n=0;i>n;n++)r.push(a);for(n=0;i>n;n++)r.push(e);for(t.wave_bit_1=new Uint8Array(r),r=[],n=0;4*i>n;n++)r.push(128);t.wave_silenzio=new Uint8Array(r)},t.prototype.inserisci_bit=function(t){var i=0,e=this.parametri,a;for(a=0==t?e.wave_bit_0:1==t?e.wave_bit_1:e.wave_silenzio,i=0;i<a.length;i++)this.data.push(a[i])},t.prototype.inserisci_byte=function(t){this.inserisci_bit(0);for(var i=0;8>i;i++)0==(1&t)?this.inserisci_bit(0):this.inserisci_bit(1),t>>=1;this.inserisci_bit(1),this.inserisci_bit(1)},t.prototype.inserisci_array=function(t){var i=0;for(i=0;i<t.byteLength;i++)this.inserisci_byte(t[i])},t.prototype.inserisci_stringa=function(t){var i=0;for(i=0;i<t.length;i++)this.inserisci_byte(t.charCodeAt(i))},t.prototype.inserisci_sincronismo=function(t){for(var i=0,e=this.parametri;i<e.bitrate*e.campionamenti*t/1e3;)this.inserisci_bit(1),i+=e.wave_bit_1.length},t.prototype.inserisci_silenzio=function(t){for(var i=0,e=this.parametri;i<e.bitrate*e.campionamenti*t/1e3;)this.inserisci_bit(-1),i+=e.wave_silenzio.length},t.prototype.genera_file=function(t){this.inserisci_sincronismo(this.parametri.sincronismo_lungo),"ascii"==t.type?this.inserisci_array(this.parametri.blocco_file_ascii):"basic"==t.type?this.inserisci_array(this.parametri.blocco_file_basic):"binary"==t.type&&this.inserisci_array(this.parametri.blocco_file_binario),"custom"!=t.type&&(this.inserisci_stringa(t.name),this.inserisci_silenzio(this.parametri.silenzio_corto),this.inserisci_sincronismo(this.parametri.sincronismo_corto)),this.inserisci_array(t.data)},t.prototype.load=function(t){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer";var e=this;i.onload=function(t){var a=i.response;if(a){var n=new Uint8Array(a);e.buffer.carica(n),e.load2()}},i.send(null)},t.prototype.cerca_blocco=function(t){var i,e,a=null;return i=this.buffer.cerca(this.parametri.blocco_intestazione,t),i>=0&&(i+=this.parametri.blocco_intestazione.length,e=this.buffer.cerca(this.parametri.blocco_intestazione,i),0>e&&(e=this.buffer.length()),a=new DataBlock(this.buffer.splitta(i,e)),a.set_data_begin(i),a.set_data_end(e)),a},t.prototype.estrai_blocco=function(t){var i,e;return i=this.cerca_blocco(t),null!==i&&(i.is_custom()||(e=this.cerca_blocco(i.get_data_end()),null!==e&&i.append_block(e))),i},t.prototype.load2=function(){var t=0,i,e;i=this.estrai_blocco(t),e=this.estrai_blocco(i.get_data_end()),console.log(i),console.log(e),this.genera_file(i),this.inserisci_silenzio(this.parametri.silenzio_lungo),this.genera_file(e),this.wave.Make(this.data),this.audio.src=this.wave.dataURI},t}();
//# sourceMappingURL=./msxtape.js.map